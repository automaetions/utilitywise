<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UtilityWise Energy Analyzer</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
--green:#4CD137;
--green-soft:#E8F5EC;
--text:#1F2D3D;
--muted:#6B7B8C;
--border:#E2E8F0;
}

*{box-sizing:border-box;}

body{
margin:0;
font-family:'Inter',sans-serif;
background:white;
color:var(--text);
}

header{
text-align:center;
padding:25px 20px 10px;
}

header img{
height:55px;
}

.container{
max-width:1000px;
margin:auto;
padding:20px;
}

.toggle-wrapper{
display:flex;
justify-content:center;
margin:20px 0;
}

.toggle{
background:#EEF2F6;
border-radius:40px;
padding:5px;
display:flex;
}

.toggle-btn{
padding:10px 20px;
border-radius:40px;
cursor:pointer;
font-weight:600;
color:var(--muted);
}

.toggle-btn.active{
background:var(--green);
color:white;
}

.card{
background:#F8FAFC;
border-radius:20px;
padding:25px;
margin-bottom:20px;
}

input{
width:100%;
padding:12px;
border-radius:14px;
border:1px solid var(--border);
margin-top:8px;
font-size:15px;
}

button{
border:none;
border-radius:14px;
padding:12px;
font-weight:600;
cursor:pointer;
}

.primary{
background:var(--green);
color:white;
width:100%;
margin-top:15px;
}

.outline{
background:white;
border:2px solid var(--green);
color:var(--green);
width:100%;
margin-top:10px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}

th,td{
padding:8px;
border-bottom:1px solid var(--border);
text-align:center;
font-size:13px;
}

.badge{
background:#FFF3CD;
padding:4px 8px;
border-radius:8px;
font-size:12px;
}

.hidden{display:none;}

.dashboard-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
gap:15px;
margin-top:20px;
}

.metric{
background:var(--green-soft);
padding:15px;
border-radius:16px;
text-align:center;
}

.metric small{
color:var(--muted);
}

.metric strong{
display:block;
font-size:20px;
margin-top:5px;
}

.modal{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.6);
display:none;
align-items:center;
justify-content:center;
padding:20px;
}

.modal-content{
background:white;
width:100%;
max-width:600px;
max-height:80vh;
overflow:auto;
border-radius:20px;
padding:20px;
}

.appliance-item{
padding:10px;
border-bottom:1px solid var(--border);
cursor:pointer;
}

.appliance-item:hover{
background:#F1F5F9;
}
</style>
</head>

<body>

<header>
<img src="UtilityWise.png">
</header>

<div class="container">

<div class="toggle-wrapper">
<div class="toggle">
<div class="toggle-btn active" id="singleBtn">Single</div>
<div class="toggle-btn" id="multiBtn">Full Home</div>
</div>
</div>

<!-- SINGLE MODE -->
<div id="singleMode">

<div class="card">
<label>Electricity Rate (₱ per kWh)</label>
<input type="number" id="rateSingle" value="13">

<label style="margin-top:20px;">Appliance Wattage</label>
<input type="number" id="wattsSingle">

<label style="margin-top:20px;">Hours per day</label>
<input type="number" id="hoursSingle" value="1">

<button class="primary" onclick="calculateSingle()">Calculate</button>

<div id="singleResult" class="hidden">
<div class="dashboard-grid">
<div class="metric"><small>Monthly</small><strong id="sMonthly"></strong></div>
<div class="metric"><small>Yearly</small><strong id="sYearly"></strong></div>
</div>
</div>

</div>
</div>

<!-- MULTI MODE -->
<div id="multiMode" class="hidden">

<div class="card">
<label>Electricity Rate (₱ per kWh)</label>
<input type="number" id="rateMulti" value="13">

<button class="outline" onclick="openModal()">+ Add Appliance</button>

<table>
<thead>
<tr>
<th>Name</th>
<th>W</th>
<th>Hrs</th>
<th>Reduce</th>
<th></th>
</tr>
</thead>
<tbody id="applianceTable"></tbody>
</table>

<button class="primary" onclick="calculateMulti()">Analyze Home</button>

<div id="multiResult" class="hidden">
<div class="dashboard-grid">
<div class="metric"><small>Monthly</small><strong id="mMonthly"></strong></div>
<div class="metric"><small>Yearly</small><strong id="mYearly"></strong></div>
<div class="metric"><small>New Yearly</small><strong id="mNewYearly"></strong></div>
<div class="metric"><small>Savings</small><strong id="mSavings"></strong></div>
<div class="metric"><small>Savings %</small><strong id="mPercent"></strong></div>
<div class="metric"><small>Biggest Drain</small><strong id="mBiggest"></strong></div>
</div>
</div>

</div>
</div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-content">
<h3>Select Appliance</h3>
<input type="text" id="searchInput" placeholder="Search appliance...">
<div id="applianceList"></div>
</div>
</div>

<script>

const GHL_WEBHOOK="PASTE_YOUR_GHL_WEBHOOK_URL_HERE";

const applianceDB=[
{name:"Aircon 1HP",watts:900},
{name:"Aircon 1.5HP",watts:1200},
{name:"Refrigerator",watts:200},
{name:"Electric Fan",watts:75},
{name:"LED TV",watts:120},
{name:"Microwave",watts:1100},
{name:"Rice Cooker",watts:1000},
{name:"Washing Machine",watts:500},
{name:"Electric Kettle",watts:1500}
];

// TOGGLE
singleBtn.onclick=()=>{singleBtn.classList.add("active");multiBtn.classList.remove("active");singleMode.classList.remove("hidden");multiMode.classList.add("hidden");};
multiBtn.onclick=()=>{multiBtn.classList.add("active");singleBtn.classList.remove("active");multiMode.classList.remove("hidden");singleMode.classList.add("hidden");};

// SINGLE
function calculateSingle(){
let rate=rateSingle.value;
let watts=wattsSingle.value;
let hrs=hoursSingle.value;

let monthly=(watts/1000)*hrs*30*rate;
let yearly=monthly*12;

sMonthly.innerText=format(monthly);
sYearly.innerText=format(yearly);

singleResult.classList.remove("hidden");
}

// MULTI
function openModal(){
modal.style.display="flex";
renderAppliances();
}

modal.onclick=(e)=>{if(e.target===modal)modal.style.display="none";};

function renderAppliances(filter=""){
applianceList.innerHTML="";
applianceDB.filter(a=>a.name.toLowerCase().includes(filter.toLowerCase()))
.forEach(a=>{
let div=document.createElement("div");
div.className="appliance-item";
div.innerText=`${a.name} (${a.watts}W)`;
div.onclick=()=>{
addAppliance(a);
modal.style.display="none";
};
applianceList.appendChild(div);
});
}

searchInput.oninput=(e)=>renderAppliances(e.target.value);

function addAppliance(a){
let row=document.createElement("tr");
row.innerHTML=`
<td>${a.name}</td>
<td>${a.watts}</td>
<td><input type="number" value="1"></td>
<td><input type="number" value="0"></td>
<td><button onclick="this.closest('tr').remove()">X</button></td>
`;
applianceTable.appendChild(row);
}

function calculateMulti(){
let rate=parseFloat(rateMulti.value);
let rows=applianceTable.querySelectorAll("tr");

let total=0,newTotal=0,list=[];

rows.forEach(r=>{
let w=parseFloat(r.children[1].innerText);
let hrs=parseFloat(r.children[2].querySelector("input").value);
let reduce=parseFloat(r.children[3].querySelector("input").value);

let monthly=(w/1000)*hrs*30*rate;
let newMonthly=(w/1000)*(hrs-reduce)*30*rate;

total+=monthly;
newTotal+=newMonthly;

list.push({name:r.children[0].innerText,value:monthly});
});

let yearly=total*12;
let newYearly=newTotal*12;
let savings=yearly-newYearly;
let percent=((savings/yearly)*100)||0;

list.sort((a,b)=>b.value-a.value);

mMonthly.innerText=format(total);
mYearly.innerText=format(yearly);
mNewYearly.innerText=format(newYearly);
mSavings.innerText=format(savings);
mPercent.innerText=percent.toFixed(1)+"%";
mBiggest.innerHTML=list.length?`<span class="badge">${list[0].name}</span>`:"-";

multiResult.classList.remove("hidden");

sendToGHL({monthly:total,yearly,savings,percent});
}

function sendToGHL(data){
if(!GHL_WEBHOOK.includes("http")) return;
fetch(GHL_WEBHOOK,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(data)
});
}

function format(n){
return "₱"+n.toLocaleString("en-PH",{minimumFractionDigits:2});
}

</script>

</body>
</html>
